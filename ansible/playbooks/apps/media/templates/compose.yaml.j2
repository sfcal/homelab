---
services:
  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:{{ sabnzbd_version }}
    container_name: sabnzbd
    restart: unless-stopped
    mem_limit: 4g
    mem_reservation: 2g
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
    ports:
      - "8080:8080"
    volumes:
      - ./sabnzbd:/config
      - /mnt/data/usenet:/data/usenet

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:{{ prowlarr_version }}
    container_name: prowlarr
    restart: unless-stopped
    mem_limit: 2g
    mem_reservation: 1g
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
    ports:
      - "9696:9696"
    volumes:
      - ./prowlarr:/config

  sonarr:
    image: lscr.io/linuxserver/sonarr:{{ sonarr_version }}
    container_name: sonarr
    restart: unless-stopped
    mem_limit: 4g
    mem_reservation: 2g
    depends_on:
      - sabnzbd
      - prowlarr
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
    ports:
      - "8989:8989"
    volumes:
      - ./sonarr:/config
      - /mnt/data:/data

  radarr:
    image: lscr.io/linuxserver/radarr:{{ radarr_version }}
    container_name: radarr
    restart: unless-stopped
    mem_limit: 4g
    mem_reservation: 2g
    depends_on:
      - sabnzbd
      - prowlarr
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
    ports:
      - "7878:7878"
    volumes:
      - ./radarr:/config
      - /mnt/data:/data

  bazarr:
    image: lscr.io/linuxserver/bazarr:{{ bazarr_version }}
    container_name: bazarr
    restart: unless-stopped
    mem_limit: 2g
    mem_reservation: 1g
    depends_on:
      - sonarr
      - radarr
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
      - TZ={{ system_timezone }}
    ports:
      - "6767:6767"
    volumes:
      - ./bazarr:/config
      - /mnt/data/media/movies:/movies
      - /mnt/data/media/tv:/tv

  plex:
    image: lscr.io/linuxserver/plex:{{ plex_version }}
    container_name: plex
    restart: unless-stopped
    mem_limit: 20g
    mem_reservation: 10g
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
      - VERSION=docker
      - ADVERTISE_IP=https://plex.5am.video:443
    ports:
      - 32400:32400
      - 1900:1900/udp
      - 5353:5353/udp
      - 8324:8324
      - 32410:32410/udp
      - 32412:32412/udp
      - 32413:32413/udp
      - 32414:32414/udp
      - 32469:32469
    volumes:
      - ./plex:/config
      - /mnt/data/media:/data/media
      - /dev/shm/plex:/transcode
    devices:
      - /dev/dri:/dev/dri

  tunarr:
    image: chrisbenincasa/tunarr:{{ tunarr_version }}
    container_name: tunarr
    restart: unless-stopped
    mem_limit: 6g
    mem_reservation: 3g
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
      - TZ={{ system_timezone }}
    ports:
      - "8000:8000"
    volumes:
      - ./tunarr:/config
      - /mnt/data/media:/media:ro
      - /dev/shm/tunarr:/cache
    devices:
      - /dev/dri:/dev/dri
    group_add:
      - '{{ media_stack_render_gid }}'

  pulsarr:
    image: lakker/pulsarr:{{ pulsarr_version }}
    container_name: pulsarr
    restart: unless-stopped
    mem_limit: 2g
    mem_reservation: 1g
    depends_on:
      - sonarr
      - radarr
      - plex
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
      - TZ={{ system_timezone }}
      - baseUrl=http://{{ media_stack_host_ip }}
      - port=3003
      - logLevel=info
      - NODE_ARGS=--log-both
    ports:
      - "3003:3003"
    volumes:
      - ./pulsarr/data:/app/data
    #  - ./pulsarr/.env:/app/.env

  cleanuparr:
    image: ghcr.io/cleanuparr/cleanuparr:{{ cleanuparr_version }}
    container_name: cleanuparr
    restart: unless-stopped
    mem_limit: 1g
    mem_reservation: 512m
    depends_on:
      - sonarr
      - radarr
      - sabnzbd
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
      - TZ={{ system_timezone }}
      - PORT=11011
    ports:
      - "11011:11011"
    volumes:
      - ./cleanuparr:/config

  huntarr:
    image: ghcr.io/plexguide/huntarr:{{ huntarr_version }}
    container_name: huntarr
    restart: unless-stopped
    mem_limit: 1g
    mem_reservation: 512m
    depends_on:
      - sonarr
      - radarr
      - prowlarr
    environment:
      - TZ={{ system_timezone }}
    ports:
      - "9705:9705"
    volumes:
      - ./huntarr:/config

  tdarr-server:
    image: ghcr.io/haveagitgat/tdarr:{{ tdarr_version }}
    container_name: tdarr-server
    restart: unless-stopped
    mem_limit: 10g
    mem_reservation: 5g
    environment:
      - PUID={{ media_stack_puid }}
      - PGID={{ media_stack_pgid }}
      - UMASK=022
      - TZ={{ system_timezone }}
      - serverIP=0.0.0.0
      - serverPort=8266
      - webUIPort=8265
      - internalNode=true
      - inContainer=true
      - ffmpegVersion=6
      - nodeName=TdarrServer
    ports:
      - "8265:8265"
      - "8266:8266"
    volumes:
      - ./tdarr/server:/app/server
      - ./tdarr/configs:/app/configs
      - ./tdarr/logs:/app/logs
      - ./tdarr/data:/app/data
      - /mnt/data/media:/media
      - /dev/shm/tdarr:/temp
    devices:
      - /dev/dri:/dev/dri

  frigate:
    image: ghcr.io/blakeblackshear/frigate:{{ frigate_version }}
    container_name: frigate
    restart: unless-stopped
    mem_limit: 4g
    mem_reservation: 2g
    environment:
      - PGID={{ media_stack_pgid }}
      - PUID={{ media_stack_puid }}
      - UMASK=022
      - TZ={{ system_timezone }}
      - FRIGATE_RTSP_PASSWORD={{ frigate_rtsp_password }}
    ports:
      - "5000:5000"
      - "8554:8554"
      - "8555:8555/tcp"
      - "8555:8555/udp"
    volumes:
      - ./frigate:/config
      - /mnt/data/frigate:/media/frigate
      - ./frigate/models:/models:ro
      - /dev/shm/frigate:/dev/shm
      - /etc/localtime:/etc/localtime:ro
    devices:
      - /dev/dri:/dev/dri
    privileged: true
    shm_size: 1g