- name: Create traefik-public network
  community.docker.docker_network:
    name: traefik-public
    state: present

- name: Create traefik config directory
  ansible.builtin.file:
    path: "{{ deploy_path }}/traefik"
    state: directory
    mode: '0755'

- name: Create traefik config subdirectory
  ansible.builtin.file:
    path: "{{ deploy_path }}/traefik/config"
    state: directory
    mode: '0755'

- name: Create traefik log directory
  ansible.builtin.file:
    path: "{{ deploy_path }}/traefik/logs"
    state: directory
    mode: '0755'

- name: Create acme.json file
  ansible.builtin.file:
    path: "{{ deploy_path }}/traefik/config/acme.json"
    state: touch
    mode: '0600'

- name: Create acme-step.json file for step-ca
  ansible.builtin.file:
    path: "{{ deploy_path }}/traefik/config/acme-step.json"
    state: touch
    mode: '0600'
    
- name: Deploy traefik.yaml configuration
  ansible.builtin.template:
    src: templates/traefik.yaml.j2
    dest: "{{ deploy_path }}/traefik/config/traefik.yaml"
    mode: '0644'
  notify: Restart media-stack

- name: Deploy config.yaml configuration
  ansible.builtin.template:
    src: templates/config.yaml.j2
    dest: "{{ deploy_path }}/traefik/config/config.yaml"
    mode: '0644'
  notify: Restart media-stack